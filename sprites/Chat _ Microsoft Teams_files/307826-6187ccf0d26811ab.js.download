"use strict";(this.webpackChunk_msteams_multi_window=this.webpackChunk_msteams_multi_window||[]).push([[307826],{19435:(e,t,r)=>{if(r.d(t,{zF:()=>f,db:()=>v,mM:()=>m,kh:()=>y}),740179==r.j)var o=r(361366);if(740179==r.j)var i=r(332130);if(740179==r.j)var n=r(741502);if(740179==r.j)var s=r(662239);if(740179==r.j)var a=r(289887);if(740179==r.j)var l=r(334025);if(740179==r.j)var d=r(625050);if(740179==r.j)var u=r(710141);if(740179==r.j)var c=r(72297);if(740179==r.j)var h=r(251893);if(740179==r.j)var p=r(471608);const f=(e,t)=>{let r;if(t){const o=s.Jt.getAllOfType("User").filter((e=>e.profile.tid===t&&e.type!==i.Ch.Anonymous));if(o.length>1){const t=s.Jt.getValue(a.Jl.globalUser);if(r=!!e&&o.find((t=>t.id===e))||o.find((e=>e.id===t.id)),r)return r;throw{message:"Multiple users found in cache with same tenantId",errorCode:l.SM.MultipleUsersPresentWithSpecifiedIdentifier}}return o[0]}if(e){const t=s.Jt.getAllOfType("User");r=null==t?void 0:t.filter((t=>t.id===e))[0]}else r=s.Jt.getValue(a.Jl.globalUser);return r},v=e=>{if(!e)return[];return s.Jt.getAllOfType("User").filter((t=>t.id!==e&&t.homeAccountId===e))||[]},m=(e,t,r,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){null==r||r.addScenarioMark("auth_get_encryption_key_start");const o=s.Jt.getValue(a.Jl.encryptionKey);if("object"==typeof o)return null==r||r.addScenarioMark("auth_get_encryption_key_stop"),o;let n,l;null==r||r.addScenarioMark("auth_get_exported_key_start");try{if(i&&(0,h.n)(e)){const e=yield t.loadModule("auth");n=(yield e.acquireEncryptionKey({correlationId:(null==r?void 0:r.correlation.id)||(0,u.pW)()})).result}else{const e=s.Jt.getValue(a.Jl.exportedEncryptionKey);n=null==e?void 0:e.exportedKey}}catch(e){return null==r||r.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Acquiring the exported key failed."},"failure"),null==r||r.addScenarioMark("auth_get_encryption_key_stop"),null}if(!n)return null==r||r.addScenarioMark("auth_get_exported_key_stop",{reason:"No exported encryption key."}),void(null==r||r.addScenarioMark("auth_get_encryption_key_stop"));try{l=yield e.crypto.subtle.importKey("raw",(0,c.k)(n),{name:"AES-CBC"},!0,["encrypt","decrypt"]),s.Jt.put(a.Jl.encryptionKey,l),null==r||r.addScenarioMark("auth_get_exported_key_stop")}catch(e){null==r||r.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Importing the key failed"},"failure"),l=null}return null==r||r.addScenarioMark("auth_get_encryption_key_stop"),l})),y=(e,t,r)=>{const o=i.JE[n.j[e]],l=f(t,void 0);if(!l)return void d.q.warn(`[AuthState] Account ${t} not found when attempting to write userAuthState`);const c=(0,p.Xx)(l),h=(0,u.u4)(null==r?void 0:r.reason)||o;s.Jt.put((0,a.VF)(c).userAuthState,{state:o,reason:h,customError:r?{errorCode:r.errorCode||r.code,message:r.message,isExpected:r.isExpected,context:r.context,subContext:r.subContext,correlationId:r.correlationId}:null}),r?d.q.warn(`[AuthState] UserAuthState updated - ${t} : ${o} errorCode: ${r.errorCode} isExpected: ${r.isExpected} correlationId: ${r.correlationId}`):d.q.log(`[AuthState] UserAuthState updated - ${t} : ${o}`)}},662239:(e,t,r)=>{if(r.d(t,{Jt:()=>c,ky:()=>g}),740179==r.j)var o=r(361366);var i=r(334025);if(740179==r.j)var n=r(625050);if(740179==r.j)var s=r(710141);if(740179==r.j)var a=r(471608);if(740179==r.j)var l=r(289887);const d=[i.aw,i.ZU,i.Fz],u={KeyVersion:"v1",UseAccountIdKey:!0};let c;const h=e=>u.UseAccountIdKey?(null==e?void 0:e.id)||"":e?JSON.stringify({tenantId:e.tenantId,oid:e.oid,accountType:e.accountType,userName:e.userName}):JSON.stringify(void 0),p=(e,t,r)=>`tmp.auth.${u.KeyVersion}.${e}.${t}.${r}`,f=e=>{const{typeName:t,user:r}=e;return{user:e.user?h(r):"GLOBAL",typeName:t,key:e.key?e.key.toUpperCase():t}},v=(e,t)=>({storageKey:u.UseAccountIdKey?p(t.user,t.typeName,t.key):`$[${t.user}][${t.typeName}][${t.key}]`,loggingKey:p(e.user?`${e.user.id}`:t.user,t.typeName,t.key)});class m{constructor(e){this._expireOffsetSeconds=i.rF.SECONDS_FIVE_MINUTES,this._expireOffsetSecondsMin=i.rF.SECONDS_PER_MINUTE,this.internalCache={GLOBAL:{User:{},Token:{},MsalAccount:{}}},this._initializeCacheForCacheItem=(e,t)=>{void 0===this.internalCache[t]?(this.internalCache[t]={},this.internalCache[t][e]={}):void 0===this.internalCache[t][e]&&(this.internalCache[t][e]={})},this._addToExternalCache=(e,t)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){let r=t;t.item.encryptedToken&&(r=this._deepCopyEncryptedToken(t));const o=f(e),{storageKey:i,loggingKey:a}=v(e,o);try{if(this._storage.setItem(i,(0,s.u4)(r)),"LogoutState"===e.typeName){const{storageKey:t}=((e,t)=>({storageKey:u.UseAccountIdKey?`$[${t.user}][${t.typeName}][${t.key}]`:p(t.user,t.typeName,t.key),loggingKey:p(e.user?`${e.user.id}`:t.user,t.typeName,t.key)}))(e,o);this._storage.setItem(t,(0,s.u4)(r))}}catch(e){n.q.error(`error in putting key [${a}] in storage, error - [${(0,s.VK)(e)}]`)}})),this._deepCopyEncryptedToken=e=>{const t=e.item,r=Object.assign({},t);return r.skypeToken?r.skypeToken="":r.token="",{item:r,hitCount:e.hitCount,shouldRefresh:e.shouldRefresh}},this._deleteFromExternalCache=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=f(e),{storageKey:r,loggingKey:o}=v(e,t);try{this._storage.removeItem(r)}catch(e){n.q.error(`error in deleting key [${o}] in storage, error - [${(0,s.VK)(e)}]`)}})),this._flushExternalCache=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const t={};Object.keys(this._storage).forEach((r=>{d.forEach((e=>{if(-1!==r.indexOf(e)){const e=this._storage.getItem(r);e&&(t[r]=e)}})),(!e&&0===r.indexOf("$[")||!e&&0===r.indexOf("tmp.auth")||e&&(-1!==r.indexOf(e.oid)||e.id&&-1!==r.indexOf(e.id)))&&this._storage.removeItem(r)})),Object.keys(t).forEach((e=>{this._storage.setItem(e,t[e])}))}catch(e){n.q.error(`error in clearing storage, error - [${(0,s.VK)(e)}]`)}})),this._isGlobalUser=e=>{var t,r;let o=null===(r=null===(t=this.internalCache.GLOBAL)||void 0===t?void 0:t.User)||void 0===r?void 0:r.User;return o||(o=this.get(l.Jl.globalUser)),o&&(0,a.FG)((0,a.Xx)(o.item),e)},this._putGlobalUserInCache=(e,t)=>{var r,o;if((null===(o=null===(r=this.internalCache.GLOBAL)||void 0===r?void 0:r.User)||void 0===o?void 0:o.User)&&e.user&&!this._isGlobalUser(e.user))return;const i=e.user?"GLOBAL":h((0,a.Xx)(t.item));this._initializeCacheForCacheItem("User",i),this.internalCache[i].User.User=t;const n=u.UseAccountIdKey?p(i,"User","User"):`$[${i}][User][User]`;this._storage.setItem(n,JSON.stringify(t))},this._validateValue=(e,t)=>{var r,o;if(!("Token"!==e.typeName||"object"==typeof t&&t.token&&t.expires))throw new Error("Invalid value for Token.");if(!("Discover"!==e.typeName||e.key!==i.rz||"object"==typeof t&&t.skypeToken&&t.expiration))throw new Error("Invalid value for Skype token.");if("User"!==e.typeName)return;const n=t;if(!(n.userName&&n.type&&n.role&&n.profile&&void 0!==n.isAuthenticated))throw new Error(`Invalid value for user. userName exists: [${!!n.userName}], type: [${n.type}], role: [${n.role}], profile exists: [${!!n.profile}],isAuthenticated: [${n.isAuthenticated}]`);const s=null===(o=null===(r=this.internalCache.GLOBAL)||void 0===r?void 0:r.User)||void 0===o?void 0:o.User,l=(0,a.Xx)(n);if(s&&!e.user&&!this._isGlobalUser(l))throw new Error("there is already global user in auth cache")},this._storage=e.localStorage,n.q.info("auth_cache initialized")}updateSetting(e,t){n.q.log(`Updating authCache setting ${e} from ${u[e]} to ${t}.`),"KeyVersion"===e&&(t!==u.KeyVersion&&(this.internalCache={}),u.KeyVersion=t),"UseAccountIdKey"===e&&(t!==u.UseAccountIdKey&&(this.internalCache={}),u.UseAccountIdKey=t)}setExpiryOffset(e,t){e&&(this._expireOffsetSeconds=e),t&&(this._expireOffsetSecondsMin=t)}put(e,t){var r,o;y(e),this._validateValue(e,t);const{typeName:i,key:n,user:s}=f(e);("Token"===i||"Discover"===i&&"SKYPE-TOKEN"===n)&&(t.fromCache=!0);let a=null===(o=null===(r=this.internalCache[s])||void 0===r?void 0:r[i])||void 0===o?void 0:o[n];return a?(a.hitCount=0,a.item=t):a={item:t,shouldRefresh:!1,hitCount:0},"User"===i&&this._putGlobalUserInCache(e,a),this._initializeCacheForCacheItem(i,s),this.internalCache[s][i][n]=a,this._addToExternalCache(e,a),!0}updateGlobalUser(e){const t="GLOBAL",r={item:e,shouldRefresh:!1,hitCount:0};return this._initializeCacheForCacheItem("User",t),this.internalCache.GLOBAL.User.User=r,this._addToExternalCache(l.Jl.globalUser,r),!0}get(e){var t,r,o;y(e);const i=f(e),{storageKey:a,loggingKey:l}=v(e,i),{typeName:d,key:u,user:c}=i;let h=null===(r=null===(t=this.internalCache[c])||void 0===t?void 0:t[d])||void 0===r?void 0:r[u];const p=!!h;if(!h)try{const e=null===(o=this._storage)||void 0===o?void 0:o.getItem(a);e&&(h=JSON.parse(e))}catch(e){n.q.error(`value for key [${l}] throw error. ${(0,s.VK)(e)}`)}if(h)return this._initializeCacheForCacheItem(d,c),this.internalCache[c][d][u]=h,("Token"===d||"Discover"===d&&"SKYPE-TOKEN"===u)&&(h.shouldRefresh=this._shouldRefresh(h.item,d),h.hitCount++,this.internalCache[c][d][u]=h,this._addToExternalCache(e,h)),void 0===h.shouldRefresh?(n.q.info(`cacheItem '[${a}]' need to refresh`),void this.del(e)):(n.q.info(`returning cacheItem '[${a}]' from cache. In memory:${+p} found: [${+!!h}]`),h);n.q.info(`value for key [${l}] not found in memory or storage`)}getValue(e){const t=this.get(e);return t?this._value(t):void 0}getAllOfType(e){const t=[],r=[];return Object.keys(this.internalCache).forEach((o=>{"GLOBAL"!==o&&Object.keys(this.internalCache[o][e]||{}).forEach((i=>{const{storageKey:n}=v({},{user:o,typeName:e,key:i});r.push(n),t.push(this.internalCache[o][e][i].item)}))})),Object.keys(this._storage).forEach((o=>{var i;if(-1===r.indexOf(o)&&-1===o.indexOf(".GLOBAL.")&&-1===o.indexOf("[GLOBAL]")&&(-1!==o.indexOf(`[${e}]`)||-1!==o.indexOf(`.${e}.`)))try{const e=this._storage.getItem(o);e&&t.push(null===(i=JSON.parse(e))||void 0===i?void 0:i.item)}catch(e){n.q.error(`value for key [${o}] throw error. ${(0,s.VK)(e)}`)}})),t}del(e){var t,r,o,i;if(!e)return n.q.error(`Invalid cacheKey: ${e}`),!1;if(!e.typeName)return n.q.error(`Invalid cacheKey type: ${e.typeName}`),!1;if("User"===e.typeName)return this.flush(e.user),!0;const s=f(e),{loggingKey:a}=v(e,s),{typeName:l,key:d,user:u}=s;(null===(r=null===(t=this.internalCache[u])||void 0===t?void 0:t[l])||void 0===r?void 0:r[d])&&n.q.info(`Value of key: [${a}] exists before deletion]`);const c=(null===(i=null===(o=this.internalCache[u])||void 0===o?void 0:o[l])||void 0===i?void 0:i[d])&&delete this.internalCache[u][l][d],h=this._deleteFromExternalCache(e);return n.q.info(`deleted from local auth-cache. key: [${a}], done - local: [${c}], storage: [${h}]`),c}delTokensWithError(e,t){var r,o,i,n;const{user:s,typeName:a}=f({user:e,typeName:"Token"});if(null===(r=this.internalCache[s])||void 0===r?void 0:r[a]){const r=this.internalCache[s][a];for(const s in r)(null===(n=null===(i=null===(o=r[s])||void 0===o?void 0:o.item)||void 0===i?void 0:i.error)||void 0===n?void 0:n.errorCode)===t&&this.del({user:e,typeName:a,key:s})}}deleteType(e,t){var r;const{user:o,typeName:i}=f({user:e,typeName:t});if(null===(r=this.internalCache[o])||void 0===r?void 0:r[i]){let t;if("Token"===i)t=this.internalCache[o][i];else{if("Discover"!==i)return;t=this.internalCache[o][i]}for(const r in t)r&&this.del({user:e,typeName:i,key:r})}}flush(e){var t,r;if(!e){n.q.info("no user provided, flushing global user from cache");const o=null===(r=null===(t=this.internalCache.GLOBAL)||void 0===t?void 0:t.User)||void 0===r?void 0:r.User;if(!o)return;e=(0,a.Xx)(o.item)}n.q.info("flushing user data from cache");const o=h(e);this.internalCache[o]={},this._flushExternalCache(e),this._isGlobalUser(e)&&(this.internalCache.GLOBAL={},this._storage.removeItem("$[GLOBAL][User][User]"),this._storage.removeItem("tmp.auth.v1.GLOBAL.User.User")),n.q.info("flushing completed")}_value(e){return e.item}_shouldRefresh(e,t){const r="Token"===t?null==e?void 0:e.expires:null==e?void 0:e.expiration,o=Math.round(Date.now()/i.rF.MILLI_PER_SECOND);let n;if(n="Discover"===t?Math.round(r/i.rF.MILLI_PER_SECOND):"Token"===t?r:void 0,e&&n){const e=n-this._expireOffsetSeconds;if(o<=n-this._expireOffsetSecondsMin)return o>=e}}}const y=e=>{if(!(-1===["Token","Discover"].indexOf(e.typeName)||e.key&&e.user))throw new Error(`key/user cannot be empty for type [${e.typeName}]: key: ${e.key}, user: ${+!!e.user}`)},g=e=>{var t;return c||(c=new m(e),(null===(t=e.localStorage)||void 0===t?void 0:t.getItem("localDebug"))&&e.loader&&(e.loader.authCache=c),c)}},289887:(e,t,r)=>{r.d(t,{VF:()=>i,px:()=>n,Jl:()=>s});var o=r(334025);const i=e=>({userDetail:{user:e,typeName:"Discover",key:"discover-user-details"},regionGtm:{user:e,typeName:"Discover",key:"discover-region-gtm"},skypeToken:{user:e,typeName:"Discover",key:"skype-token"},user:{user:e,typeName:"User"},tenants:{user:e,typeName:"Tenants"},loginValidation:{user:e,typeName:"LoginValidation"},userAuthState:{user:e,typeName:"UserAuthState"},meetingDetails:{user:e,typeName:"MeetingDetails"}}),n=(e,t,r)=>({user:e,typeName:"Token",key:`${t}${r?`-external-${r}`:""}`}),s={logoutState:{typeName:o.ZU},authSessionId:{typeName:o.Fz},globalUser:{typeName:"User"},primaryUserId:{typeName:"PrimaryUserId"},encryptionKey:{typeName:"EncryptionKey"},exportedEncryptionKey:{typeName:"ExportedEncryptionKey"},initializationVector:{typeName:"InitializationVector"}}},233743:(e,t,r)=>{if(r.d(t,{kj:()=>p,gA:()=>f,Zl:()=>v,fG:()=>m,Gp:()=>y,MD:()=>g,iK:()=>_,xq:()=>C,SH:()=>I,Ri:()=>b,$R:()=>k,et:()=>E}),740179==r.j)var o=r(361366);if(740179==r.j)var i=r(332130);if(740179==r.j)var n=r(902578);if(740179==r.j)var s=r(343324);if(740179==r.j)var a=r(184717);if(740179==r.j)var l=r(710141);if(740179==r.j)var d=r(449856);if(740179==r.j)var u=r(334025);if(740179==r.j)var c=r(625050);if(740179==r.j)var h=r(471608);const p=(e,t,r)=>(0,a.Tr)({context:"authentication",subContext:e,errorCode:(null==t?void 0:t.errorCode)||"ErrorCodeMissing",message:(null==t?void 0:t.errorMessage)||"ErrorMessageMissing",isExpected:null==t?void 0:t.isExpected,correlationId:r.id}),f=(e,t,r)=>{var o,i,n,s,a,l;const d=p(e,t,r);return Object.assign(Object.assign({},d),{message:d.message,stack:d.stack,errorMetaData:{accountId:null===(i=null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.profile)||void 0===i?void 0:i.id,name:null===(s=null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.profile)||void 0===s?void 0:s.displayName,email:null===(l=null===(a=null==t?void 0:t.result)||void 0===a?void 0:a.profile)||void 0===l?void 0:l.email}})},v=(e,t="https://login.microsoftonline.com/")=>{var r,o;const n=null===(r=e.extraQueryParameters)||void 0===r?void 0:r.tenantId,s=`${t}${n}`,a=(null===(o=e.extraQueryParameters)||void 0===o?void 0:o.accountType)||i.Ch.Aad;return{correlation:e.correlation,silent:e.silent,extraQueryParameters:Object.assign(Object.assign({},e.extraQueryParameters),{authority:s}),userIdentifier:{accountType:a,tenantId:n,id:e.accountId||"",userName:"",oid:""}}},m=e=>{var t;return e.accountId&&(null===(t=e.extraQueryParameters)||void 0===t?void 0:t.tenantId)},y=(e,t,r)=>{var o;return(0,a.Tr)({context:"authentication",subContext:e,errorCode:t.errorCode||"ErrorCodeMissing",message:t.message||"ErrorMessageMissing",isExpected:null!==(o=t.isExpected)&&void 0!==o&&o,correlationId:r.id})},g=(e,t,r)=>{const{correlation:i,userIdentifier:n}=r,s=(0,o.__rest)(r,["correlation","userIdentifier"]),d=`[webview2][${e}] result: ${(0,l.VK)(t)}, options: 'userIdentifier:${!!n},correlationId:${i.id},${(0,l.VK)(s)}'`;return(null==t?void 0:t.isExpected)?c.q.warn(d):c.q.error(d),(0,a.Tr)({context:"webview2",subContext:e,errorCode:(null==t?void 0:t.errorCode)||"ErrorCodeNotFound",message:(null==t?void 0:t.errorMessage)||d,correlationId:i.id,isExpected:null==t?void 0:t.isExpected})},_=(e,t,r)=>{const{correlation:i,userIdentifier:n}=r,s=(0,o.__rest)(r,["correlation","userIdentifier"]),d=`[webview2][${e}] error: '${(0,l.VK)(t)}', options: 'userIdentifier:${!!n},correlationId:${(null==i?void 0:i.id)||i.id},${(0,l.VK)(s)}'`;return t.isExpected?c.q.warning(d):c.q.error(d),(0,a.Tr)({context:"webview2",subContext:e,errorCode:t.errorCode,message:t.message||d,correlationId:i.id,isExpected:t.isExpected,innerError:t})},C=(e,t,r,o,i)=>{if(r.addEventData(["module_fetch"]),!e[t]){r.addEventData(["nativeApiNotAvailable"]);const e=p(`auth-webview2::_${t}`,{correlationId:i.id,errorCode:"hostCommMissing",providerErrorContext:void 0,status:n.oo.FAILED},i);throw o({error:e}),e}},I=(e,t,r)=>{var o;const{accountId:i,correlation:s,prompt:a,loginHint:l,extraQueryParameters:d,windowId:u}=e,c={accountId:i,correlationId:s.id,domainHint:(null==r?void 0:r("enableAad"))?(null==r?void 0:r("enableMultiCloud"))?void 0:n.nU.prod:n.nU.life,extraQueryParameters:(0,h.nW)(d),loginHint:l,silent:"none"===a,windowId:u};return t.addEventData([`nativeArgs:{domainPresent:${c.domainHint}`,`extraParams:${null===(o=c.extraQueryParameters)||void 0===o?void 0:o.length}`,"idPresent:"+ +!!c.accountId,"loginHintPresent:"+ +!!c.loginHint,`silent:${c.silent}}`]),c},b=(e,t,r)=>{var o;const i=k(t.userIdentifier),n={resource:e,correlationId:t.correlation.id,accessTokenToRenew:t.accessTokenToRenew,claim:t.claim,silent:null!==(o=t.silent)&&void 0!==o?o:"login"!==t.prompt,userIdentifier:i,tenantId:t.tenantId,extraQueryParameters:(0,h.nW)(t.extraQueryParameters),windowId:t.windowId};return r.addEventData(["nativeArgs:{","accessTokenPresent:"+ +!!n.accessTokenToRenew,"claimPresent:"+ +(0,h.WD)(t.claim),"idPresent:"+ +!!(null==i?void 0:i.id),`silent:${n.silent}`,"userToUse:"+ +!!i,"externalTenant:"+ +!!n.tenantId,"}"]),n},k=e=>({id:e.id,tenantId:e.tenantId,oid:e.oid,upn:e.userName}),E=(e,t)=>{var r;let o;c.q.info("Getting user profile");const n=null===(r=e.extendedProperties)||void 0===r?void 0:r.find((e=>"acct"===e.name));let s;n&&(o=+n.value);try{s=e.profile.id||(e.profile.oid.startsWith("000")?e.profile.oid.replace(/[0-]/g,""):e.profile.oid)}catch(t){s=e.profile.oid}const a=x(e,!!(null==t?void 0:t("enableMTO")),!!(null==t?void 0:t("enableCCM")));let l=1===o?i.w4.Guest:i.w4.Member;return a===i.Yf.Ccm&&(l=i.w4.Anonymous),{id:s,userName:e.userName||e.profile.email,profile:{acct:o,altsecid:"",amr:[],aud:"",exp:-1,email:e.profile.email,family_name:"",given_name:e.profile.displayName,iat:1,iss:"",name:e.profile.displayName,preferred_username:e.userName||e.profile.email,nbf:-1,nonce:"",oid:e.profile.oid,onprem_sid:"",sub:"",tid:e.profile.tenantId,unique_name:e.profile.displayName,upn:e.profile.email,ver:"1.0",isHomeAccount:e.profile.isHomeAccount},isAuthenticated:!1,type:(0,h.QG)(e.profile.tenantId),cloud:(0,h.nL)(e),homeAccountId:e.profile.isHomeAccount?s:(0,h.vt)(e),role:l,subType:a}},x=(e,t,r)=>{var o;let n=i.Yf.Default;if(t||r){const a={id:(0,l.pW)(),scenarioName:s.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"},[c,h]=(0,d.OU)({options:{correlation:a},subContext:"auth-helper::getUserSubType",scenarioName:s.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"}),p=null===(o=e.extendedProperties)||void 0===o?void 0:o.find((e=>e.name===u.GA));if(p){const e=t&&p.value.indexOf(u.f)>-1,o=r&&p.value.indexOf(u.u1)>-1;e?n=i.Yf.Mto:o&&(n=i.Yf.Ccm)}h({reason:"Extended properties wids claim check done.",userSubType:n},"success")}return c.q.log(`User subType set to ${n}, enableMTO: ${t}`),n}},251893:(e,t,r)=>{r.d(t,{n:()=>o});const o=e=>{var t;return!!(null===(t=null==e?void 0:e.chrome)||void 0===t?void 0:t.webview)}},471608:(e,t,r)=>{if(r.d(t,{b6:()=>y,yI:()=>g,vt:()=>_,LP:()=>C,QG:()=>I,nL:()=>b,Ig:()=>k,Xx:()=>x,qv:()=>$,nW:()=>U,aS:()=>A,Kv:()=>O,FG:()=>M,fM:()=>S,jV:()=>T,PU:()=>N,dW:()=>j,au:()=>L,S1:()=>D,NL:()=>q,WD:()=>K,_Z:()=>R,ps:()=>P,Fr:()=>G,N3:()=>V}),740179==r.j)var o=r(361366);var i,n=r(197981);if(740179==r.j)var s=r(332130);if(740179==r.j)var a=r(193022);if(740179==r.j)var l=r(343324);if(740179==r.j)var d=r(625050);if(740179==r.j)var u=r(334025);if(740179==r.j)var c=r(662239);if(740179==r.j)var h=r(184717);if(740179==r.j)var p=r(710141);if(740179==r.j)var f=r(289887);if(740179==r.j)var v=r(19435);if(740179==r.j)var m=r(233743);!function(e){e.Otp="mail",e.GFed="google.com"}(i||(i={}));const y=e=>(d.q.info(`[returnTokenForAnonUser][${e}] empty token return for anonymous user`),{token:"",expires:Math.floor((new Date).setMinutes(u.uI.FIFTEEN)/u.rF.MILLI_PER_SECOND),fromCache:!0}),g=(e,t,r)=>{if(e===s.G7.prod||e===s.G7.life)return"";const o=null==r?void 0:r("instanceUrl"),i=o?`${o}${null!=t?t:"common"}`:"";return d.q.log(`[getAuthorityFromCloud] Get Authority from cloud type - ${i}`),i},_=e=>{const t=e.homeAccountId;return null==t?void 0:t.split(".")[0]},C=(e,t)=>{var r;d.q.info("Anon flow - anonymous user created");const o=e===u.zP;return{id:w,isAuthenticated:!0,userName:(null==t?void 0:t.userName)||"anonymous",profile:{oid:$(e),tid:e,upn:(null===(r=null==t?void 0:t.profile)||void 0===r?void 0:r.upn)||"",puid:""},role:s.w4.Anonymous,type:s.Ch.Anonymous,homeAccountId:w,cloud:(null==t?void 0:t.cloud)||(o?s.G7.life:s.G7.prod),subType:s.Yf.Default}},I=e=>e===a.e0?s.Ch.MsaLife:s.Ch.Aad,b=e=>{if(I(e.profile.tenantId)===s.Ch.MsaLife)return s.G7.life;switch(e.profile.sovereignty){case s.ym.prod:return s.G7.prod;case s.ym.gcch:return s.G7.gcch;case s.ym.dod:return s.G7.dod;case s.ym.gallatin:return s.G7.gallatin;default:return s.G7.prod}},k=(e,t,r,o)=>{var l,c,h,p,f,v;if((null==t?void 0:t.subType)===s.Yf.Ccm)return t;if(!t||(0,n.isEmpty)(t.profile)||t.role===s.w4.Anonymous||t.userRole===u.uI.TWO||!t.isAuthenticated&&e.isAnonEligible||!t.isAuthenticated&&o)return d.q.info("checking anon flow"),((e,t,r,o)=>{const i=(null==t?void 0:t.profile.tid)||r||(null==e?void 0:e.tenantId);if(i&&(t||o||(null==e?void 0:e.isAnonEligible)&&(null==e?void 0:e.isAnonRestrictionSatisfied)))return C(i,t)})(e,t,r,o);t.role=1===(null===(l=t.profile)||void 0===l?void 0:l.acct)?s.w4.Guest:s.w4.Member;let m=0===(null===(h=null===(c=t.profile)||void 0===c?void 0:c.altsecid)||void 0===h?void 0:h.indexOf("1:"))?s.Ch.Msa:s.Ch.Aad;return(null===(p=t.profile)||void 0===p?void 0:p.idp)&&(null===(f=t.profile)||void 0===f?void 0:f.iss)!==t.profile.idp?(m=t.profile.idp===i.Otp?s.Ch.Otp:m,m=t.profile.idp===i.GFed?s.Ch.GFed:m):(null===(v=t.profile)||void 0===v?void 0:v.tid)===a.e0&&(m=s.Ch.MsaLife),E(t,m)},E=(e,t)=>(e.type=t,e.profile.oid=e.profile.oid||$(e.profile.tid),e.cloud||(e.cloud=e.type===s.Ch.MsaLife?s.G7.life:s.G7.prod),!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.subType||(e.subType=s.Yf.Default),d.q.info(`User role = [${e.role}], type = [${t}]`),e),x=e=>{if(!e)throw new Error("getUserIdentifier: User cannot be null");return{tenantId:e.profile.tid,oid:e.profile.oid,accountType:e.type,userName:e.userName,id:e.id}},$=e=>`8:defaultOid:${e}`,w="anonAccountId",U=e=>{const t=[];for(const r in e)Object.hasOwnProperty.call(e,r)&&e[r]&&t.push({name:r,key:r,value:"string"==typeof e[r]?e[r]:(0,p.u4)(e[r])});return t},A=(e,t)=>{var r;t.addEventData(["update-global-user:t"]),t.addScenarioMark("auth_update_global_user_start");const o=(0,v.zF)(e,void 0);if(o)return t.addScenarioMark("auth_update_global_user_foundUser"),c.Jt.updateGlobalUser(o);throw t.addScenarioMark("auth_update_global_user_noUserFound"),i=null===(r=t.correlation)||void 0===r?void 0:r.id,(0,h.Tr)({context:"core-auth-base",subContext:"getUserFromAccountId",correlationId:i,errorCode:u.SM.UserNotFoundError,message:"Cannot update global user ude to missing user"});var i},O=e=>e?(null==e?void 0:e.id)?null==e?void 0:e.id:`${null==e?void 0:e.oid}-${null==e?void 0:e.tenantId}`:"unknown user",M=(e,t)=>!!e&&!!t&&((e.id||t.id)&&e.id===t.id||e.tenantId===t.tenantId&&e.oid===t.oid&&e.userName===t.userName),S=(e,t,r)=>{var o;const i=new CustomEvent(t,{detail:r});null===(o=null==e?void 0:e.dispatchEvent)||void 0===o||o.call(e,i)},T=(e,t,r,o,i)=>{const n=k(e,t,o,i);return n&&(d.q.info(`[auth-helper][getMappedUserAndSetItToCache][${r}] put user in cache.`),c.Jt.put((0,f.VF)(x(n)).user,n)),n},N=(e,t,r,o)=>{if(u.s9(e))throw o.addEventData(["scope_invalid:1"]),d.q.warn(`[core-auth-base][acquireToken][${r.source}][${r.id}] invalid scope. resource: [${e}]`),(0,h.Tr)({context:"core-auth-base",subContext:"acquireToken",message:`request with [${null==t?void 0:t.id}-${null==t?void 0:t.oid}-${null==t?void 0:t.tenantId}] sent from invalid resource: ${e}`,errorCode:u.SM.InvalidScopeResource,isExpected:!0,correlationId:r.id})},j=(e,t,r,o,i)=>(o.push("user_missing"),(0,h.Tr)({context:"core-auth-base",subContext:e,errorCode:u.SM.UserNotFoundError,isExpected:r,message:`request sent with [${t}] failed as user not found`,innerError:new Error("User Null or empty"),correlationId:i})),L=(e,t,r,o)=>(0,h.Tr)({context:"core-auth-base",subContext:e,errorCode:u.SM.UnsupportedParameter,isExpected:r,message:`${t} parameter is not currently supported`,innerError:new Error(`${t} parameter is not currently supported`),correlationId:o});const D=(e,t,r,o,i,n)=>{var s,a;null==o||o.push(`errorCode:${(null==t?void 0:t.errorCode)||"undefined"},errorMessage:${(null==t?void 0:t.message)||"undefined"}`),o&&o.length>0&&o.push("$");const l=function(e,t,r="",o,i){return{contentType:r,context:"core-auth-base",correlationId:null==t?void 0:t.correlationId,endpointUrl:i||"unset",errorCode:(null==t?void 0:t.errorCode)||"AcquireToken Error",innerError:t,isExpected:null==t?void 0:t.isExpected,message:(0,p.VK)(t),reason:(null==o?void 0:o.join(";"))||"",subContext:e}}(e,t,i,o,n),c=l.errorCode.includes(u.SM.InvalidScopeResource)||(null===(s=l.message)||void 0===s?void 0:s.includes(u.SM.InvalidScopeResource))||l.isExpected||(null===(a=l.innerError)||void 0===a?void 0:a.isExpected);return c?d.q.warning(`Error found ${(0,p.VK)(t)}`):d.q.error(`Error found ${(0,p.VK)(t)}`),c?null==r||r.incomplete(l):null==r||r.fail(l),l},q=JSON.stringify({access_token:{xms_cc:{values:["CP1"]}}}),K=e=>!(!e||e===q),R=(e,t,r,o,i)=>{var n,s,a,l;return r.tflClaim&&(r.accessTokenToRenew=r.tflClaim),void 0===r.prompt&&void 0===r.silent&&(!r.accessTokenToRenew&&!K(r.claim)||(null==o?void 0:o("disablePromptFor401"))&&!((e,t)=>{const r=(null==t?void 0:t("enablePromptResourcesFor401"))||[];return!(!e||!r)&&Array.isArray(r)&&r.findIndex((t=>e.includes(t)))>-1})(e,o)?(r.prompt="none",r.silent=!0):(r.prompt="login",r.silent=!1)),i&&!r.accessTokenToRenew&&(r.forceRenew||!1===r.silent||"login"===r.prompt)&&(d.q.info("[core-auth-base][acquireToken] force renewing."),r.accessTokenToRenew=i.item.token),t.addEventData(["cacheToken:"+ +!!i,"tflClaim:"+ +!!r.tflClaim,"accessTokenToRenew:"+ +!!r.accessTokenToRenew,"forceRenew:"+ +!!r.forceRenew,`prompt: ${r.prompt}`,"silent:"+ +!!r.silent]),(null===(s=null===(n=null==i?void 0:i.item)||void 0===n?void 0:n.error)||void 0===s?void 0:s.errorCode)&&t.addEventData([`errorInToken:[${(null===(l=null===(a=null==i?void 0:i.item)||void 0===a?void 0:a.error)||void 0===l?void 0:l.errorCode)||""}]`]),r},P=(e,t,r,i,n,a)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const o=null==a?void 0:a("buildCloud"),l=null==a?void 0:a("enableMultiCloud"),u=null==a?void 0:a("enableCCM");if(d.q.log(`starting cloud misMatch check. Env: ${r}, buildCloud: ${o}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`),!e.cloud||!o||e.cloud===o)return d.q.log("No cloud mismatch detected."),t.addEventData(["cloudMismatch:0"]),e;if(t.addEventData(["cloudMismatch:1","enableCCM:"+ +!!u,"meetingDetails:"+ +!!n.meetingDetails]),u&&n.meetingDetails){t.addScenarioMark("ccm_flow_start");try{const r=(null==a?void 0:a("instanceUrl"))||"https://login.microsoftonline.com/",o=n.meetingDetails.tenantId,l=r?`${r}${o}`:"",d=yield i.acquireToken("https://api.spaces.skype.com",{correlation:n.correlation,silent:n.silent,userIdentifier:x(e),extraQueryParameters:{authority:l}});if(null==d?void 0:d.account){t.addEventData(["account:1"]);const e=(0,m.et)(d.account,a);if(e.subType===s.Yf.Ccm)return t.addEventData(["ccmUser:1"]),e.id=`${e.id}_${n.meetingDetails.conversationId}`,e.type=s.Ch.Anonymous,c.Jt.put((0,f.VF)(x(e)).meetingDetails,n.meetingDetails),t.addScenarioMark("ccm_flow_end"),e;t.addEventData(["ccmUser:0",`sub:${e.subType}`])}t.addScenarioMark("ccm_flow_end")}catch(e){t.addScenarioMark("ccm_flow_end",e)}}if(l){t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${r}, enableMultiCloud: ${l}, buildCloud: ${o}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`});const s=yield F(e,n.correlation.id,i);return Promise.reject(s)}throw c.Jt.del({user:x(e),typeName:"User"}),t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${r}, buildCloud: ${o}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`}),new Error("cloud mis-match... reboot required")})),G=(e,t,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return new Promise((i=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(e.length<=0)return i({count:0,failure:[]});let o=0;const n=[];for(const s of e){o++;try{const r=t(s);yield r,o>=e.length&&i({count:o,failure:n})}catch(t){n.push(o),null==r||r(t,o,s),o>=e.length&&i({count:o,failure:n})}}}))))})),F=(e,t,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var o;const i={id:t,scenarioName:l.RG.AuthWebLogin,source:"core-auth::login"},n=(yield null===(o=r.getUserImage)||void 0===o?void 0:o.call(r,{id:e.id,correlation:i}))||"",s={cloud:e.cloud,accountId:e.id,email:e.profile.email,name:e.profile.name,pictureBlob:n};return(0,h.MD)({errorMetaData:s,authSubErrorCode:"MultiCloudMismatch",name:u.SM.CloudMismatch,message:"Cloud Mismatch Detected",context:"Login",correlationId:t,errorCode:u.SM.CloudMismatch,subContext:"checkForCloudMismatch",isExpected:!0})})),V=(e,t,r,o)=>{K(r)&&e.addEventData([`isSameToken: ${o===t.token}`]);const i=(e=>{const t=(e-Math.floor((new Date).getTime()/u.rF.MILLI_PER_SECOND))*u.rF.MILLI_PER_SECOND/u.rF.ONE_MINUTE;return Math.floor(t)})(t.expires);e.addEventData([`tokenLifeTime: ${i}`,`fromCache: ${t.fromCache}`])}},72297:(e,t,r)=>{r.d(t,{z:()=>i,k:()=>n});var o=r(86048);const i=e=>o.Buffer.from(e).toString("base64"),n=e=>o.Buffer.from(e,"base64")},307826:(e,t,r)=>{if(r.d(t,{g:()=>p}),740179==r.j)var o=r(332130);if(740179==r.j)var i=r(184717);if(740179==r.j)var n=r(710141);if(740179==r.j)var s=r(471608);var a=r(334025);if(740179==r.j)var l=r(625050);if(740179==r.j)var d=r(591277);let u,c,h;function p(e,t,r,o){if(Object.getOwnPropertyDescriptor(Window,"mockApi")||Object.defineProperty(Window,"mockApi",{value:{enable:()=>{h=!0},disable:()=>{h=!1},setConfig:f}}),function(e,t){u||(u={});u[t]=e}(e,t),h=o,h){try{c="string"==typeof r?Object.assign(Object.assign({},c),JSON.parse(decodeURIComponent(r))):Object.assign(Object.assign({},c),r)}catch(e){l.q.warning(`[MOCK-API] cannot parse config: ${r}`)}v(e,t)}else c={}}function f(e,t={}){c||(c={}),c[e]=t;const r=e.split(".")[0];v(null==u?void 0:u[r],r)}function v(e,t){Object.getOwnPropertyNames(c).filter((e=>e.startsWith(`${t}.`))).map((e=>e.replace(`${t}.`,""))).forEach((r=>{var o,s;const a=(null===(o=Object.getOwnPropertyDescriptor(e,r))||void 0===o?void 0:o.value)||(null===(s=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),r))||void 0===s?void 0:s.value);Object.defineProperty(e,r,{configurable:!0,value:(...o)=>h?(l.q.warning(`[MOCK-API] returning mocked response for ${t}.${r}`),function(e,t){var r;const o=null==c?void 0:c[`${e}.${t}`];if(o&&o.error)throw function(e,t,r){return(0,i.MD)({name:(null==e?void 0:e.name)||"",context:(null==e?void 0:e.context)||t,subContext:(null==e?void 0:e.subContext)||r,reason:null==e?void 0:e.reason,errorCode:(null==e?void 0:e.errorCode)||"ErrorCodeNotFound",correlationId:(null==e?void 0:e.correlationId)||(0,n.pW)(),isExpected:(null==e?void 0:e.isExpected)||!1,message:(null==e?void 0:e.message)||`[MockApi][${t}][${r}]`,authSubErrorCode:null==e?void 0:e.authSubErrorCode,errorMetaData:null==e?void 0:e.errorMetaData,serverResponse:null==e?void 0:e.serverResponse})}(o.error,e,t);if(o&&o.success){const e=function(e){switch(e){case"aquireToken":return y;case"user":return m();case"hostMachineUsers":return[g];case"users":return[m()];case"emptyList":return[]}return{}}(o.success.defaultValue);return Array.isArray(e)?o.success.returnValue?Array.isArray(o.success.returnValue)?[...e,...o.success.returnValue]:[...e,o.success.returnValue]:e:Object.assign(Object.assign({},e),null===(r=o.success)||void 0===r?void 0:r.returnValue)}return}(t,r)||a.apply(e,o)):a.apply(e,o)})}))}const m=()=>(0,s.Ig)(new d.N("https://test.msft.com"),{userName:"TestUserName@email.com",role:o.w4.Member,profile:{name:"Test",oid:(0,s.qv)("123456789"),tid:"123456789"}}),y={token:"TestToken",expires:Date.now()+a.rF.SECONDS_FIVE_MINUTES,fromCache:!1},g={accountType:"Aad",id:"TestHostMachineUserId",displayName:"Test User",emailPhone:"test@email.com",picture:""}},591277:(e,t,r)=>{if(r.d(t,{N:()=>n,j:()=>d}),740179==r.j)var o=r(334025);if(740179==r.j)var i=r(625050);class n{constructor(e){this._hash="",this._search="",this._pathname="",this._isAnonEligible=!1,this._isAnonRestrictionSatisfied=!1,this._tid=void 0,this._queryStrings={},this._parse=e=>{let t=Object.create(null);return"string"!=typeof e?t:(e=e.trim().replace(/^[?#&]/,""))?(e.split("&").forEach((e=>{const r=e.replace(/\+/g," ").split("=");let o=r.shift();const n=r.length>0?decodeURIComponent(r.join("=")):null;if(o){if(o=decodeURIComponent(o),"context"===o&&0===(null==n?void 0:n.indexOf("{")))try{const e=JSON.parse(n);for(const t in e)!e.hasOwnProperty(t)||"tid"!==t.toLowerCase()&&"tenantid"!==t.toLowerCase()||(this._tid=e[t]);t=Object.assign(Object.assign({},t),e)}catch(e){i.q.error(e)}if(Object.prototype.hasOwnProperty.call(t,o))Array.isArray(t[o])?t[o].push(n):t[o]=[t[o],n];else{t[o]=n;const e=o.toLowerCase();!n||"tid"!==e&&"tenantid"!==e||(this._tid=n)}}})),t):t};try{this._currenttUrl=Object.freeze(new URL(e))}catch(t){throw new Error(`[TeamsUrl::ctor] - error - ${t} url ${e}`)}if(this._currenttUrl.hash&&-1!==this._currenttUrl.hash.indexOf("#/")){const e=this._currenttUrl.href.substring(this._currenttUrl.origin.length),t=e.indexOf("#");t>=0&&(this._hash=e.substr(t),this._pathname=e.substr(0,t));const r=this._hash.indexOf("?");r>=0&&(this._search=this._hash.substr(r))}this._queryStrings=this._parse(this._search||this._currenttUrl.search);const t=s(this._currenttUrl);this._isAnonEligible=t[0],this._isAnonRestrictionSatisfied=t[1]}get href(){return this._currenttUrl.href}get isLocal(){return 0===this._currenttUrl.host.indexOf("local.teams.office.com")}get hash(){return this._hash||this._currenttUrl.hash}get pathname(){return this._pathname||this._currenttUrl.pathname}get search(){return this._search||this._currenttUrl.search}get origin(){return this._currenttUrl.origin}get searchParams(){return{get:e=>this._queryStrings[e]}}get queryStrings(){return this._queryStrings}get tenantId(){return 0===this._currenttUrl.host.indexOf("teams.live.")?o.zP:this._tid}get isAnonEligible(){return this._isAnonEligible}get isAnonRestrictionSatisfied(){return this._isAnonRestrictionSatisfied}get alternateUrl(){const e=new URL(this._currenttUrl.href);return this.isLocal?(e.port?e.port="":e.port="8080",e.href):(0===e.host.indexOf("teams.live.")?e.host="teams.microsoft.com":e.host="teams.live.com",e.href)}}const s=e=>{if(!l)return[!1,!1];for(const t of l)if(t.anonUrlMatch&&e.href.indexOf(t.anonUrlMatch)>-1)return[!0,a(t,e.href)];return[!1,!1]},a=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(const r of e.restrictions)if(t.indexOf(r)>-1)return!0;return!1};let l=740179==r.j?[]:null;const d=e=>{e&&(l=e)}},902578:(e,t,r)=>{var o,i,n,s;r.d(t,{oo:()=>o,nU:()=>i,O3:()=>s}),function(e){e.SUCCESS="SUCCESS",e.CANCELLED="CANCELLED",e.FAILED="FAILED",e.TIMEOUT="TIMEOUT"}(o||(o={})),function(e){e.prod="prod",e.life="life",e.dod="dod",e.gcch="gcch",e.gallatin="gallatin",e.airgap08="airgap08",e.airgap09="airgap09"}(i||(i={})),function(e){e.Aad="Aad",e.MsaLife="MsaLife"}(n||(n={})),function(e){e.AADReconnecting="AADReconnecting",e.Failure="Failure",e.InteractionRequired="InteractionRequired",e.SignInRestriction="SignInRestriction",e.SkypeReconnecting="SkypeReconnecting",e.Up="Up"}(s||(s={}))},625050:(e,t,r)=>{r.d(t,{q:()=>i});var o=r(193022);const i=new class{constructor(){this.logLevel=o.in.Info,this.localCallback=void 0,this.error=e=>this.logMessage(o.in.Error,e),this.warning=e=>this.logMessage(o.in.Warning,e),this.warn=e=>this.logMessage(o.in.Warning,e),this.info=e=>this.logMessage(o.in.Info,e),this.log=e=>this.logMessage(o.in.Info,e),this.verbose=e=>this.logMessage(o.in.Verbose,e),this.debug=e=>this.logMessage(o.in.Verbose,e)}initialize(e,t=o.in.Verbose){this.localCallback=e,this.logLevel=t}executeCallback(e,t){this.localCallback?this.localCallback(e,t):console&&console.log(t)}logMessage(e,t){if(e>this.logLevel)return;const r=`[Auth]: ${t}`;this.executeCallback(e,r)}}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/307826-6187ccf0d26811ab.js.map